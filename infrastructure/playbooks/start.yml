- hosts: servers
  become: yes
  tasks:
    - name: Start the application
      shell: frankenphp php-server -r public --domain debian.orb.local </dev/null >/dev/null 2>&1 &
      environment:
        APP_RUNTIME: Runtime\\FrankenPhpSymfony\\Runtime
      args:
        chdir: /srv/current
      
    - name: Start the messenger worker
      shell: php bin/console messenger:consume </dev/null >/dev/null 2>&1 &
      args:
        chdir: /srv/current

    - name: Compute user vectors
      command: php bin/console app:compute-user-vectors
      args:
        chdir: /srv/current

    - name: Compute user recommendations
      command: php bin/console app:compute-user-recommendations
      args:
        chdir: /srv/current
